<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map </title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <style>
        * {
            box-sizing: border-box;
        }

        #map-canvas{
                       width: 100%;
                       height: 75vh;
        }

    </style>
</head>
<body>
<!--NAV BAR WITH CITY SEARCH-->
    <nav class="navbar navbar-light bg-light">
        <a class="navbar-brand">Search For Weather</a>
            <input id="input-search" class="form-control mr-sm-2" type="search" placeholder="Enter city name" aria-label="Search">
            <button id='search-button' class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
    </nav>
<!---- DEFAULT CURRENT WEATHER --->
    <h1>Weather Application</h1>
    <div class="container">
        <div id="current" >Current Weather</div>
    </div>
    <br>
<!------------ 3 DAY FORECAST CARDS -------->
    <h2>Three Day Forecast</h2>
    <div class="container">
        <div class="row">
            <div class="col-4">
                <div class="card bg-light mb-3 text-center">
                    <div class="card-header">
                        <h3>Day 1</h3>
                    </div>
                        <div class="card-body">
                        <p id="today" class="card-text"></p></div>
                    </div>
                </div>
<!--CARD 2-->
            <div class="col-4">
                <div class="card bg-light mb-3 text-center">
                    <div class="card-header">
                        <h3>Day 2</h3>
                    </div>
                    <div class="card-body">
                    <p id="tomorrow" class="card-text"></p></div>
                </div>
            </div>
<!-- CARD 3-->
            <div class="col-4">
                <div class="card bg-light mb-3 text-center">
                    <div class="card-header">
                        <h3>Day 3</h3>
                    </div>
                    <div class="card-body">
                    <p id="third-day" class="card-text"></p></div>
                </div>
            </div>
        </div>
    </div>
<!--MAP DIV-->
    <div id="map-canvas"></div>
    <input id ="searchAddress" type="text" placeholder="Enter a new address"><button id=searchBtn type="submit">Search</button>

<!--SCRIPTS-->
    <!--JQUERY-->
    <script src="js/jquery-2.2.4.js"></script>
    <!--GOOGLE MAPS API-->
    <!-- Load the Google Maps API [DON'T FORGET TO USE A KEY] -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCGUvFLzHTLNNvsJKYQofXpE5-R7ixdIeQ"></script>
    <!-- BOOTSTRAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script>
        "use strict";
        $(document).ready(function(){
            function loadTable(){

    // -------------------- AJAX REQUEST -----------------
                $.get('https://api.openweathermap.org/data/2.5/forecast', {
                    APPID: "b8144fb122e1149359f2ba7f6f167365",
                    q: "San Antonio, US",
                    units: "imperial"
                }).done(function (weather) {
                        console.log(weather);
    // --------------- CURRENT WEATHER IN SA --------------
                        $('#current').html('<h3>' + weather.city.name +'</h3>' + '<br>' + '<img src="http://openweathermap.org/img/w/'+ weather.list[0].weather[0].icon +'.png">' + '<br>' + 'Current temperature is: ' + '<br>' + parseInt(weather.list[0].main.temp) + 'º');


                        for (var i = 0; i < weather.list.length; i ++) {
                            var table = "";

         // --------- BUILD THE TABLE -------
                            table += '<tr>';
                            table += '<td>' + '<img src="http://openweathermap.org/img/w/'+ weather.list[i].weather[0].icon +'.png">' + '</td>';
                            table += '</tr><tr>';
                            table += '<td>' + parseInt(weather.list[i].main.temp_max) + 'º'+ '/' + parseInt (weather.list[i].main.temp_min) + 'º'+ '</td>';
                            table += '</tr><tr>';
                            table += '<td>' + '<strong>' + 'Clouds: ' + '</strong>' + weather.list[i].weather[0].description + '</td>';
                            table += '</tr><tr>';
                            table += '<td>' + '<strong>' + 'Humidity: ' + '</strong>' + weather.list[i].main.humidity + '%' + '</td>';
                            table += '</tr><tr>';
                            table += '<td>' + '<strong>' + 'Wind Speed: ' + '</strong>' + weather.list[i].wind.speed + ' mph' + '</td>';
                            table += '</tr><tr>';
                            table += '<td>' + '<strong>' +  'Pressure: ' + '</strong>' + weather.list[i].main.pressure + '</td>';
                            table += '</tr>';

            // ------- END OF TABLE CREATION / 3 DAY FORECAST -------

                            if (i === 0) {

                                $('#today').html(table);
                            } else if (i === 8){

                                $('#tomorrow').html(table);
                            } else if(i === 16){

                                $('#third-day').html(table);
                            }
                        }
                    });

            };
            loadTable();

            //------- NEW CITY SEARCH ------

            $('#search-button').click(function(){
                var newCity = $('#input-search').val();
                console.log(newCity);

                // ------ AJAX REQUEST -------
                $.get('https://api.openweathermap.org/data/2.5/forecast', {
                    APPID: "b8144fb122e1149359f2ba7f6f167365",
                    q: newCity,
                    units: "imperial"
                }).done(function (weather) {
                    console.log(weather);

                    // --- CURRENT WEATHER IN NEW SEARCH CITY  ---
                    $('#current').html('<h3>' + weather.city.name +'</h3>' + '<br>' + '<img src="http://openweathermap.org/img/w/'+ weather.list[0].weather[0].icon +'.png">' + '<br>' + 'Current temperature is: ' + '<br>' + parseInt(weather.list[0].main.temp) + 'º');


                    for (var i = 0; i < weather.list.length; i ++) {
                        var table = "";

                        // -- BUILD THE TABLE ---
                        table += '<tr>';table += '<td>' + '<img src="http://openweathermap.org/img/w/'+ weather.list[i].weather[0].icon +'.png">' + '</td>';
                        table += '</tr><tr>';
                        table += '<td>' + parseInt(weather.list[i].main.temp_max) + 'º'+ '/' + parseInt (weather.list[i].main.temp_min) + 'º'+ '</td>';
                        table += '</tr><tr>';
                        table += '<td>' + '<strong>' + 'Clouds: ' + '</strong>' + weather.list[i].weather[0].description + '</td>';
                        table += '</tr><tr>';
                        table += '<td>' + '<strong>' + 'Humidity: ' + '</strong>' + weather.list[i].main.humidity + '%' + '</td>';
                        table += '</tr><tr>';
                        table += '<td>' + '<strong>' + 'Wind Speed: ' + '</strong>' + weather.list[i].wind.speed + ' mph' + '</td>';
                        table += '</tr><tr>';
                        table += '<td>' + '<strong>' +  'Pressure: ' + '</strong>' + weather.list[i].main.pressure + '</td>';
                        table += '</tr>';

                        // ------- END OF TABLE CREATION / 3 DAY FORECAST FOR CITY SEARCH---

                        if (i === 0) {
                            $('#today').html('').append(table);
                        } else if (i === 8){
                            $('#tomorrow').html('').append(table);
                        } else if(i === 16){
                            $('#third-day').html('').append(table);
                        }
                    }
                });

            });
    // INIT MAPS ---
            var geocoder = new google.maps.Geocoder();

            var address = { lat: 29.426791,
                lng: -98.489602};


// Set our map options
            var mapOptions = {
                // Set the zoom level
                zoom: 19,

                // This sets the center of the map at our location
                center: address,

                mapTypeID: 'satellite'
            };

            // Render the map
            var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

//creates marker on map
            var marker = new google.maps.Marker({
                position: address,
                animation: google.maps.Animation.DROP,
                map: map
            });

            marker.setMap(map);
            // var infowindow = new google.maps.InfoWindow({
            //     content: 'Sarah\'s favorite restuarant'
            // });

// Set our address to geocode
//             var restaurantAddress = "3119 Roosevelt Ave, San Antonio, TX, 78214";
//
// --creating a lat/long variable for the restaurant to use in marker:
//             var nichas = new google.maps.LatLng(29.365830, -98.481742);
//             var marker = new google.maps.Marker({
//                 position: nichas,
//                 map: map
//             });




            var newAddress = function(){
                var newAddress = document.getElementById('searchAddress').value;
                console.log(newAddress);

                // Geocode our address
                geocoder.geocode({ "address": newAddress }, function(results, status) {
                    // Check for a successful result
                    if (status == google.maps.GeocoderStatus.OK) {
                        //Rerender the map
                        var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

                        // Recenter the map over the address
                        map.setCenter(results[0].geometry.location);

                        //sets marker on new address
                        marker.position = results[0].geometry.location;

                        marker.setMap(map);
                    } else {

                        // Show an error message with the status if our request fails
                        alert("Geocoding was not successful - STATUS: " + status);
                    }
                });

            };
//
            var search = document.getElementById('searchBtn');

            search.addEventListener('click', newAddress);



        });

    </script>
</body>
</html>